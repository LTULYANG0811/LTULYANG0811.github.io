---
title:    "嶺東科大-FinTech 金融科技課程"
subtitle: "利用R語言-台灣南六企業股價k線及技術指標"
author: "楊永列 Yang Yung-Lieh"
date: "2017年2月16日"
output: html_document 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#南六企業董事長黃清山-發揚嶺東科技大學母校精神拼出璀璨人生

嶺東科技大學創立超過半世紀，為台灣孕育眾多傑出人才，南六企業董事長黃清山就是其中的典範之一，
他不僅打造華人世界第一、亞洲第二大的不織布王國，更體現母校校訓「學以致用，誠以待人」，
持續勤學創新、不斷奉獻公益！
國中畢業後，黃清山進入嶺東商專會計科就讀，印象最深刻的，就是母校優美田園的環境影響！
「如同校歌的歌詞一樣，校園周邊真的就是『春色 景麗 平野 輕蔥 黎明挹秀氣 桃李吐青榮…』！
當年大家都會到筏子溪釣魚，而我也在專四時，一面看著溪流，一面立下了將來創業的夢想！」他回想著當年的求學印象。
身教言教境教奠定創業基礎在學校就讀的五年時光中，
創辦人黎明與蔡亞萍夫妻的身影最讓黃清山難忘，「兩人生活儉樸與認真教學、待學生如子女的溫暖，
都是最佳的身教與言教，而學校的校訓『學以致用，誠以待人』，更是我一生遵奉的原則！」
在會計專業的學習上，黃清山深刻地記得，在成本會計的課堂後，
他仍有疑問，老師耐心傳授成本控管的心法，包括人力、良率、生產率、機械折舊、採構等成本細節，
奠定他未來經營工廠的數字概念，得以精準控制成本，逐漸成為業界知名的「拼王」! 
創立南六企業　打造不織布王國 <http://www.cw.com.tw/article/article.action?id=5080766>.


## 第1步：R工作目錄指令

```{r}
getwd()
setwd("D:/Fintech/")
getwd()
```


## 第2步：R使用quantmod套件指令

```{r}
library(quantmod)
```

## 第3步：R網路抓取Yahoo中南六企業股價資料

```{r}
getSymbols("6504.TW")
LTU6504<-get("6504.TW") 
head(LTU6504)
tail(LTU6504)

#包含每天開盤價(6504.Open)、最高價(6504.High)、最低價(6504.Low)、收盤價(6504.Close)、成交量(6504.Volume)、(還原權值)6504.Adjusted。
```

## 第4步：R指令劃出LTU6504股價之K線圖


```{r}
chartSeries(LTU6504)

getDividends("6504.TW") 
#获取股息数据
#getDividends函数可以获取上市公司的股息数据。

#获取除权除息数据
#使用getSplits()函数获取上市公司的除权除息数据：
getSplits("6504.TW") 


chartSeries(LTU6504["2013-06::2017-02"],theme="white") 
#我只要看此段區間的資料,同時把版面調成白色
```


## 第5步：R指令劃出LTU6504股價之技術指標
 
## 5.1 畫出20日平均線(月線)  
```{r}
ma_20<-runMean(LTU6504[,4],n=20)

#LTU6504[,4]代表6504股價每日的收盤價(LTU6504.Close)
#因為收盤價放在第四行所以這樣表示。
#runMean這個函數以即n=20表示計算過去20天的平均數。
#因此。ma_20是一個時間序列，每一時間點表示過去20天的收盤平均。

addTA(ma_20,on=1,col="blue")

#將20日均線(ma_20)的圖形，用藍色線條加到目前K線圖上 
```

## 5.2 畫出60日平均線(季線)

```{r}
ma_60<-runMean(LTU6504[,4],n=60)


#runMean這個函數以即n=60表示計算過去60天的平均數。
#因此。ma_60是一個時間序列，每一時間點表示過去60天的收盤平均。

addTA(ma_60,on=1,col="red")

#將60日均線(ma_60)的圖形，用紅色線條加到目前K線圖上 
```


 
## 第6步：買賣LTU6504股價策略回測

```{r}
position<-Lag(ifelse(ma_20>ma_60, 1,0))

#為了方便講解回測，我們用最普通的均線策略：當20ma大於60ma時，全壓買進
#當20ma小於60ma時,空手
#position為一個時間序列，以日為單位，如果20ma大於60ma，設值為1;
#否則設值為0
#由於我們是日資料,訊號發生時只能隔天做交易，故將這向量全部往後遞延一天
tail(position)
```


## 第7步：買賣LTU6504策略ROC之報酬

Rate Of Change(ROC):變動率指標變動率指標是一個動能指標，它測量一定時期內股票價格的變化比率。
以當日的收盤價和N天前的收盤價比較，通過計算股價某一段時間內收盤價變動的比例，應用價格的移動比較來測量價位動量，
達到事先探測股價買賣供需力量的強弱，進而分析股價的趨勢及其是否有轉勢的意願，屬於反趨向的指標之一。

```{r}
#ROC計算：log(今天收盤價/昨天收盤價)，乘上poistion代表。
#若1則持有，若0則空手。

return<-ROC(Cl(LTU6504))*position

#由於我們策略條件是60ma>20ma之後才會交易，故統計值從2014-08-01開始;
#另外6504在2013年有配發股利，故我們只統計2013年到2017年的資料

return<-return['2013-07-01/2017-02-14']
#cumsum計算累計值，即將每一分量之前的值累加起來。
#取exp函數是要計算累計損亦。
#(這裡運用國中數學:log(a)+log(b)=log(ab)，exp(log(ab))=ab)

return<-exp(cumsum(return))

#將累計損益圖畫出來。此策略的損益圖形如下，
#橫軸為時間軸，縱軸為報酬率，1代表原始自有資金100%。

plot(return) 

```



